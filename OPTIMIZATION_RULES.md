# AI Engineering & Optimization: Best Practices

Этот документ содержит правила и workflow, выработанные в ходе разработки проекта **AI Scout**. Эти правила помогают избегать «детских болезней» при работе с AI, внешними API и мобильной адаптацией в будущих проектах.

---

## 1. Регламент «Экономичного API» (Quota Optimization)
**Проблема:** Использование самых простых методов API (например, `search`) быстро сжигает бесплатные лимиты.
*   **Правило:** Никогда не используй «тяжелые» методы там, где есть специализированные.
    *   *Пример YouTube:* Вместо `search` (100 units) всегда используй `playlistItems` (1 unit). Это экономит квоту в 100 раз.
*   **Workflow:** 
    1.  Один раз найти ID канала/ресурса по ссылке.
    2.  Сохранить его в БД.
    3.  В кронах обращаться только по конкретному ID, избегая поиска.

## 2. Система «Каскадного ИИ» (AI Redundancy)
**Проблема:** Даже платные API падают или выдают ошибки 429/500 в самый неподходящий момент.
*   **Правило:** Всегда реализуй цепочку провайдеров.
*   **Workflow каскада:** `Gemini Direct` → `OpenRouter` → `OpenAI` → `Moonshot (Kimi)`. 
    *   Если один провайдер вернул ошибку, следующий должен подхватить запрос автоматически в течение одной сессии.
    *   Всегда возвращай «Fallback» (заглушку), чтобы UI не «дымил» красным цветом при отказе всех ИИ.

## 3. Протокол Hobby-плана (Serverless Limits)
**Проблема:** Стандартные Serverless-функции (Vercel/Netlify) обрываются через 10 секунд, а AI-анализ может длиться 30-50 секунд.
*   **Правило:** Для любых функций, использующих AI или циклы по каналам, ВСЕГДА прописывай `maxDuration`.
*   **Код:** `export const maxDuration = 60;` (для Vercel).
*   **Правило крона:** Разноси по времени сбор данных и их анализ. Сначала — легкий сбор в базу, потом — тяжелый AI-анализ по расписанию.

## 4. Золотой Стандарт ИИ-Анализа (Prompting Rules)
**Проблема:** ИИ часто «галлюцинирует» или включает в отчет мусор (ссылки на ТГ-каналы, промокоды, мелкие демо-проекты).
*   **Правило «Минусовых уточнений»:** В системном промпте всегда четко прописывай исключения (Negative Prompts).
*   **Workflow контента:** 
    *   Запрещать включать в "Mentions" названия мелких скриптов из видео.
    *   Всегда требовать ПЕРЕВОД заголовка на русский язык (`titleRu`), чтобы лента была единообразной.
    *   Задавать минимальный объем (например, "минимум 500 слов") для глубокого анализа, иначе ИИ ленится.

## 5. Workflow «Премиальной Адаптивности» (Mobile UI)
**Проблема:** Просто сделать блоки резиновыми недостаточно для ощущения «дорогого» продукта.
*   **Правило «Stack & Shrink»:**
    1.  **Навигация:** На мобильных прячь текст кнопок, оставляй только иконки (экономия места).
    2.  **Сетка:** Grid должен быть `cols-1` на мобайле, но `cols-2` на планшетах (не оставляй пустоту).
    3.  **Модалки:** Header в модальном окне на мобильном должен становиться вертикальным (центрирование иконки над текстом), иначе заголовок будет узким и некрасивым.
    4.  **Action Buttons:** На узких экранах кнопки должны занимать всю ширину (full-width), чтобы по ним было легко попасть пальцем.

## 6. Синхронизация по Часовым Поясам (Quota Sync)
**Проблема:** Кроны запускаются ночью, когда лимиты еще не обнулились.
*   **Правило:** Планируй «тяжелые» задачи через 1-2 часа ПОСЛЕ обнуления квот.
    *   *Расчет:* YouTube сбрасывает квоту в 11:00 МСК. Лучшее время для крона — 12:00.

---

## 7. Классификация и Структурирование (Tool Taxonomy)
**Проблема:** При большом количестве инструментов в «Избранном» становится сложно найти нужный из-за отсутствия четкой группировки.
*   **Правило:** Используй 5 глобальных функциональных групп для фильтрации вместо десятков мелких категорий.
*   **Группы:**
    1.  **Языковые модели:** Все LLM, ИИ-ассистенты и модели генерации текста.
    2.  **Веб-разработка:** Сборщики, хостинг, базы данных, API, бэкенд и фронтенд фреймворки.
    3.  **Голос и Аудио:** Сервисы синтеза речи, транскрибации и работы со звуком.
    4.  **Дизайн и Видео:** Редакторы, генерация изображений/видео и UI-инструменты.
    5.  **Разное:** Утилиты, не вошедшие в основные группы.
*   **Workflow:** В коде фильтрации используй сопоставление ключевых слов (mapping) для автоматического распределения инструментов по этим группам на лету.

---
*Сохранено как стандарт разработки для будущих проектов. Последнее обновление: 1 марта 2026.*
